{"version":3,"sources":["1-leaflet-pulsating-icon.js","app.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["(function(window) {\r\n\r\n    L.Icon.Pulse = L.DivIcon.extend({\r\n\r\n        options: {\r\n            className: '',\r\n            iconSize: [12,12],\r\n            fillColor: '#C70039',\r\n            color: '#C70039',\r\n            animate: true,\r\n            heartbeat: 1,\r\n        },\r\n\r\n        initialize: function (options) {\r\n            L.setOptions(this,options);\r\n\r\n            // css\r\n            \r\n            var uniqueClassName = 'lpi-'+ new Date().getTime()+'-'+Math.round(Math.random()*100000);\r\n\r\n            var before = ['background-color: '+this.options.fillColor];\r\n            var after = [\r\n\r\n                'box-shadow: 0 0 6px 2px '+this.options.color,\r\n\r\n                'animation: pulsate ' + this.options.heartbeat + 's ease-out',\r\n                'animation-iteration-count: infinite',\r\n                'animation-delay: '+ (this.options.heartbeat + .1) + 's',\r\n            ];\r\n\r\n            if (!this.options.animate){\r\n                after.push('animation: none');\r\n                after.push('box-shadow:none');\r\n            }\r\n\r\n            var css = [\r\n                '.'+uniqueClassName+'{'+before.join(';')+';}',\r\n                '.'+uniqueClassName+':after{'+after.join(';')+';}',\r\n            ].join('');\r\n \r\n            var el = document.createElement('style');\r\n            if (el.styleSheet){\r\n                el.styleSheet.cssText = css;\r\n            } else {\r\n                el.appendChild(document.createTextNode(css));\r\n            }\r\n\r\n            document.getElementsByTagName('head')[0].appendChild(el);\r\n\r\n            // apply css class\r\n\r\n            this.options.className = this.options.className+' leaflet-pulsing-icon '+uniqueClassName;\r\n\r\n            // initialize icon\r\n            \r\n            L.DivIcon.prototype.initialize.call(this, options);\r\n        \r\n        }\r\n    });\r\n\r\n    L.icon.pulse = function (options) {\r\n        return new L.Icon.Pulse(options);\r\n    };\r\n\r\n\r\n    L.Marker.Pulse = L.Marker.extend({\r\n        initialize: function (latlng,options) {\r\n            options.icon = L.icon.pulse(options);\r\n            L.Marker.prototype.initialize.call(this, latlng, options);\r\n        }\r\n    });\r\n\r\n    L.marker.pulse = function (latlng,options) {\r\n        return new L.Marker.Pulse(latlng,options);\r\n    };\r\n\r\n})(window);","$(document).ready(function () {\n\n\n\n    // configure leaflet\n    var london_center = [51.5, -0.09];\n    var initial_zoom = 13\n\n    var mapbox_tiles = 'https://api.mapbox.com/styles/v1/11soma/cjgry9jr3000z2roggiqpzehx/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoiMTFzb21hIiwiYSI6ImNqZDBuMjV6dDF2bWcyeG8xNDByZXpjbjgifQ.5B5BJIcEtqFELPs36GUxcA';\n    var map_attribution = 'Map data &copy; <a href=\"http://openstreetmap.org\">OpenStreetMap</a> contributors, <a href=\"http://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>, Imagery Â© <a href=\"http://mapbox.com\">Mapbox</a>';\n    var max_zoom = 18;\n\n\n    // create a leaflet instance\n    var map = L.map('mapContainer').setView(london_center, initial_zoom);\n\n    // add custom tiles to the map\n    L.tileLayer(mapbox_tiles, {\n        attribution: map_attribution,\n        maxZoom: max_zoom,\n        id: 'mapbox.mapbox-streets-v7',\n    }).addTo(map);\n\n\n    // create a custom pulsating marker\n    var pulsingIcon = L.icon.pulse({ iconSize: [8, 8], color: '#C70039' });\n\n\n    function getArtistInfo(artists_id_list, handleData) {\n        var artists_info_list = []\n        for (var i = 0; i < artists_id_list.length; i++){\n            var artist_id = artists_id_list[i]\n            $.ajax({\n                contentType: \"application/json\",\n                dataType: \"json\",\n                type: 'GET',\n                url: \"https://fuinki-api.herokuapp.com/artist/\" + artist_id,\n                success: function (data) {\n                    var result = data[0]\n                    artists_info_list.push(result)\n\n                },\n                error: function (data, errorThrown) {\n                    console.log('request failed :' + errorThrown);\n                }\n            });\n        }\n        handleData(artists_info_list)\n    }\n\n    // add markers\n    function addMarkers(data) {\n        $.each(data, function (data, e) {\n            var lat = e.location.lat\n            var lng = e.location.lng\n            var marker = L.marker([lat, lng], { icon: pulsingIcon }).addTo(map);\n            function onMarkerClick() {\n\n                 // general\n                close_div = '</div>'\n\n                // event title\n                var event_name = e.name\n                var event_url = e.url\n                var event_page = '<a class=\"event__page\" href=\"' + event_url + '\"><h2>' + event_name + '</h2></a>'\n                var event_class = '<div class=\"event__event_page\">'\n                var event_name_div = event_class + event_page + close_div\n\n                // create venue section\n                var venue_section_class = '<div class=\"event__venue_section\">'\n                var venue_title_div = '<h3> Venue </h3>'\n\n\n                // venue name\n                var venue_name = e.venue.name\n                var venue_name_link = '<h4>' + venue_name + '</h4>'\n                var venue_class = '<div class=\"event__venue_name\">'\n                var venue_name_div = venue_class + venue_name_link + close_div\n\n                // event time\n                var event_time = e.time\n                var event_time_h5 = '<h5>' + event_time + '</h5>'\n                var time_class = '<div class=\"event__time\">'\n                var event_time_div = time_class + '<h5>Time:</h5>' +  event_time_h5 + close_div\n\n                \n\n                // foursquare rate\n                if (typeof e.foursquare.rating !== \"undefined\"){\n                    var foursquare_rate = e.foursquare.rating\n                    var foursquare_rate_color = e.foursquare.rating_color\n                    var foursquare_rate_with_color = '<h5>FourSquare rate:</h5>' + '<h5 style=\"color:#' + foursquare_rate_color + ';\">' + foursquare_rate + '</h5>'\n                    var foursquare_rate_class = '<div class=\"event__foursquare_rate\">'\n                    var foursquare_rate_div = foursquare_rate_class + foursquare_rate_with_color + close_div\n                } else {\n                    var foursquare_rate_div = ''\n                }\n\n                // foursquare tips\n                var foursquare_tips = e.foursquare.tips\n                var foursquare_class = '<div class=\"event__foursquare_tips\">'\n                if (typeof foursquare_tips !== \"undefined\"){\n                    if (typeof foursquare_tips[0] !== \"undefined\") {\n                        if (typeof foursquare_tips[0].text !== \"undefined\") {\n                            var foursquare_tips_div = foursquare_class + '<h5>Visitor tips:</h5>' + '<h5>' + foursquare_tips[0].text + '</h5>' + close_div\n                        } else {\n                            var foursquare_tips_div = ''\n                        }\n                    }\n                    else {\n                        var foursquare_tips_div = ''\n                    }\n                } else {\n                    var foursquare_tips_div = ''\n                }\n\n                // construct venue section \n\n                var venue_section = venue_section_class + venue_title_div + venue_name_div + event_time_div + foursquare_rate_with_color + foursquare_tips_div\n\n                // create artist section\n                var artist_section_class = '<div class=\"event__artist_section\">'\n\n                // artists id, name, songkick page from event database\n                var artists = e.artists\n                var artist_class = '<div class=\"event__artist\">'\n                var number_of_artists= artists.length\n                var artists_id_list = []\n                var artists_name_list = []\n                var artists_songkick_page_list = []\n                for (var i = 0; i < number_of_artists; i++){\n\n                    // artist id\n                    var artist_id = artists[i].id\n                    artists_id_list.push(artist_id)\n\n                    // artist name\n                    var artist_name = artists[i].name\n                    var artist_name_div = '<h4>' + artist_name + '</h4>'\n                    artists_name_list.push(artist_name_div)\n\n                    // artist songkick page\n                    var artists_songkick_page_url = artists[i].songkick_url\n                    var artists_songkick_page = '<a class=\"event__songkick_button\" href=\"' + artists_songkick_page_url + '\"></a>'\n                    artists_songkick_page_list.push(artists_songkick_page)\n                }\n\n                // artist info\n                getArtistInfo(artists_id_list, function(output) {\n                setTimeout(function() {\n                    var artist = '<h3>Artists</h3>'\n                    for (var i = 0; i < output.length; i++){\n                        \n                        // got the artist data \n                        var artist_info = output[i]\n\n                        // artist image\n                        if(typeof artist_info.spotify.image !== \"undefined\"){\n                            if(typeof artist_info.spotify.image.slice(-1)[0] !== \"undefined\"){\n                                var artist_image_url = artist_info.spotify.image.slice(-1)[0].url\n                            }\n                        }\n                        if(typeof artist_image_url == \"undefined\"){\n                            if (typeof artist_info.lastfm.image !== \"undefined\"){\n                                if(artist_info.lastfm.image[0].url !== \"\"){\n                                    var artist_image_url = artist_info.lastfm.image[0].url\n                                } else {\n                                    var artist_image_url = \"../assets_src/img/no_image_artist.jpeg\"\n                                }\n                            } else {\n                                var artist_image_url = \"../assets_src/img/no_image_artist.jpeg\"\n                            }\n                        }\n                        var artist_image = '<img src=\"' + artist_image_url + '\">'\n\n\n                        // artist spotify page\n                        var artist_spotify_page_url = artist_info.spotify.href\n                        var artist_spotify_page = '<a class=\"event__spotify_button\" href=\"' + artist_spotify_page_url + '\"></a>'\n\n                        // artist lastfm page\n                        var artist_lastfm_page_url = artist_info.lastfm.url\n                        var artist_lastfm_page = '<a class=\"event__lastfm_button\" href=\"' + artist_lastfm_page_url + '\"></a>'\n\n                        // construct artist section\n                        var artist_elem = artist_class + artist_image + artists_name_list[i] + \n                            artists_songkick_page_list[i] + artist_spotify_page + artist_lastfm_page + close_div\n                        artist += artist_elem\n                        var artist_section = artist_section_class + artist + close_div\n                    }\n\n                    // finally construct the card\n                    var final = event_name_div + artist_section + venue_section\n                    marker.bindPopup(final).openPopup()\n\n                }, 500);\n                    \n                    \n            \n                })\n            }\n            marker.on('click', onMarkerClick);\n\n\n        });\n    }\n\n    $.ajax({\n        contentType: \"application/json\",\n        dataType: \"json\",\n        type: 'GET',\n        url: \"https://fuinki-api.herokuapp.com/london/events/2018-05-18\",\n        success: function (data) {\n            //Do stuff with the JSON data\n            // events = data\n            addMarkers(data)\n        },\n        error: function (data, errorThrown) {\n            console.log('request failed :' + errorThrown);\n        }\n\n    });\n\n\n\n\n\n\n\n\n});\n\n\n"]}